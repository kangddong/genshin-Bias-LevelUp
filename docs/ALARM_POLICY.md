# Alarm Policy

## 1) 최초 알림 권한 요청
- 시점: 앱 시작 시
- 조건: 시스템 알림 권한 상태가 `notDetermined`일 때 즉시 `requestAuthorization` 호출
- 목적: 추적 시작 전에 권한 상태를 선반영해 UX 지연을 줄임

## 2) 거절(denied) 이후 재요청 정책
- iOS 정책상 동일 앱 내 시스템 권한 팝업 재노출은 불가
- 재요청 트리거: 사용자가 캐릭터/무기 추적을 시작(선택 ON)하려고 할 때
- 처리 방식: 앱 내 재요청 대신 시스템 설정 앱(`UIApplication.openSettingsURLString`)으로 라우팅

## 3) 알림 타입 정책
- `case1` (최애 유도형):
  - 조건: 오늘 육성 가능한 대상에 사용자의 최애(캐릭터 또는 무기)가 포함될 때
  - 내용: 이미지 + 대화형 문구(예: "오늘은 OOO 육성시킬 수 있는 날이야!")
- `case2` (요약형):
  - 조건: `case1` 미충족 시 기본 사용
  - 내용: 오늘/내일 오픈 수량 요약(캐릭터 n명, 무기 n개)
- 우선순위:
  - 동일 시점에서는 `case1`이 `case2`를 대체
  - 중복 발송 방지를 위해 동일 슬롯에 1개만 생성

## 4) 최애(Favorite) 정책
- 저장 단위: 캐릭터 1개 + 무기 1개
- 노출 위치:
  - 마이페이지 최상단에 현재 최애 상태 표시
  - 상세 페이지에서 최애 설정/해제 가능

## 5) 알림 시간 정책
- 알림 요일 설정: 제거
  - 앱 도메인이 요일 기반 오픈 정보이므로 사용자별 요일 토글은 중복 기능으로 간주
- 알림 시간:
  - 하루 최대 3회
  - 슬롯 간 최소 간격 4시간
- 스케줄 방식:
  - 서버 타임존(Asia/Shanghai) 기준
  - 롤링 14일 one-shot 로컬 알림을 재생성

## 6) 재스케줄 트리거
- 앱 시작/포그라운드 복귀
- 선택 대상 변경(캐릭터/무기)
- 최애 변경
- 알림 시간 슬롯 변경
- 권한 상태 변경
